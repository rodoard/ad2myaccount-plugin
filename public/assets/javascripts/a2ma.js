(function(){$(function(){var n,t,e,a,i,r,o,u,l,d,s,c,f,m,v,g,p,h,k,w,y,b,C,_,I,x,j,F,T,z,S;return t=$(".mute"),e=$(".unmute"),n=$(".countdown"),z=" http://localhost:3000",l=null,S=!1,F=function(){return localStorage.getItem("timer_id")},k=function(n){return localStorage.setItem("timer_id",n)},h=function(){return localStorage.removeItem("timer_id")},u=function(){return $(".a2maonline").hasClass("mini")?"mini":"full"},o=function(){return clearInterval(F()),h()},T=function(){var t,e,i,r;return console.log("timer fired"),S||w(l),n=$(".countdown"),n.length>0?(e=parseInt(n.data("remaining")),r=$("video").length>0&&$("video")[0].ended,e>0&&!r?($("video").length>0?4===$("video")[0].readyState&&(t=$("video")[0],e=parseInt(t.duration)-parseInt(t.currentTime)):e-=1,n.text(""+e+"s"),n.data("remaining",e),i={remaining:{time:e}},console.log("post remaining",i),parent.postMessage(i,"*")):(o(),"mini"===u()?a(function(){return c()}):p("completed_placeholder",null,null,function(){return I(!1)}))):void 0},I=function(n){return location.href="/survey?offering_id="+$(".a2maonline").data("offering-id")+"&skipped="+n},$(".message").click(function(){var n;return n=$(this).data("operation"),parent.postMessage(n,"*"),f[n]()}),$(".go_to_site").click(function(){var n;return n=$(this).data("operation"),f[n]()}),f={minimize:function(){return $(".a2maonline").removeClass("full"),$(".a2maonline").addClass("mini"),t.show()},maximize:function(){return $(".a2maonline").removeClass("mini"),$(".a2maonline").addClass("full"),f.unmute(),t.hide()},mute:function(){return e.show(),t.hide(),$("video").prop("muted",!0)},unmute:function(){return t.show(),e.hide(),$("video").prop("muted",!1)},close:function(){return $("video").remove()}},j=function(){return null===F()&&(console.log("setting up timer"),n.length>0)?k(setInterval(T,1e3)):void 0},o(),j(),e.hide(),parent.postMessage({offering:{id:$(".a2maonline").data("offering-id")}},"*"),g=function(){var n;return n=$("video"),n.length>0?n[0].play():void 0},v=function(){var n;return n=$("video"),n.length>0?n[0].pause():void 0},x=function(){return g(),j()},m=function(){return v(),o()},w=function(t){var e;return console.log("setting video position"),null!=t&&t>0&&(e=0,null!=$("video")[0].duration&&(e=$("video")[0].duration-parseInt(t),e>0&&($("video")[0].currentTime=e)),n.data("remaining",t)),S=!0,console.log("playing video"),g(),l=null},s=function(t){var e;if(console.log("iframe received message!:  ",t.data),null!=t.data.size&&("mini"===t.data.size?($(".a2maonline").addClass("mini"),$(".a2maonline").removeClass("full")):"full"===t.data.size&&($(".a2maonline").addClass("full"),$(".a2maonline").removeClass("mini"))),null!=t.data.remaining&&(console.log("setting video remaining ",t.data.remaining),$("video").length>0?(l=t.data.remaining,null==t.data.remaining&&$(".countdown").data("remaining",$("video").get(0).duration)):(console.log("setting remaining ",t.data.remaining),n.data("remaining",t.data.remaining))),null!=t.data.command){if(e=t.data.command,"pauseAds"===e)return m();if("restartAds"===e)return x()}},b=function(){return window.removeEventListener("message",s,!1),window.addEventListener("message",s,!1)},b(),r=function(){return $(".survey-form").data("activity")!==!0?($(".survey-inactivity").show(),$(".survey-form").hide()):void 0},_=function(){return $(".survey-form").mousemove(function(){return $(this).data("activity",!0)}),setTimeout(r,5e3)},p=function(t,e,a,i){var r,o,u,l,d,s,c;return r=$(".a2maonline"),o=$("video"),l=!1,o.length&&(l=o.prop("muted")),s=null,n.length>0&&(d=parseInt(n.data("remaining")),s=parseInt($(".a2maonline").data("duration"))-d),c="full",$(".a2maonline").hasClass("mini")&&(c="mini"),u={metric:{muted:l,size:c,seconds:s,metric_type:t,offering_id:$(".a2maonline").data("offering-id"),comment:e,rating:a}},$.ajax({url:""+z+"/metrics.json",data:JSON.stringify(u),dataType:"json",contentType:"application/json",type:"POST"}).done(i)},c=function(){var n;return n=location.href.split("?")[0],n=n.split("#")[0],location.href=n},a=function(n){return p("completed",null,null,function(){return n()})},i=function(){return c()},y=function(){return $(".like-button").click(function(n){var t,e;return t=$(this),e=t.data("liked"),n.preventDefault(),null!=e&&e?void 0:p("liked",null,null,function(){return $(".like-button").text("Liked!"),t.data("liked",!0),t.css(":hover","background-color: #0088FF")})}),$(".star-button").click(function(n){var t,e,a;return t=$(this),a=t.data("favorites"),n.preventDefault(),null!=a&&a?void 0:(e={ad_id:$("#ad_id").val()},$.ajax({type:"post",dataType:"json",url:""+z+"/ads/favorite",data:e,success:function(){return $(".star-button").text("Favorites!"),t.data("favorites",!0),t.css(":hover","background-color: #0088FF")}}))}),$(".share-button").click(function(){var n;return n=$(this),n.parent("li").html("<a class='btn facebook-button' href='https://www.facebook.com/sharer/sharer.php?u=http://ad2myaccount.com' target='_blank'> <i class='fa fa-facebook'></i> <span class='full'>Facebook</span> </a> <a target='_blank' class='btn twitter-button' data-url='http://ad2myaccount.com' data-lang='en data-text='Join me at Ad2MyAccount! Start getting paid to watch ads, like I do! Click on my referral link to join! #Ad2MyAccount' data-size='400px' href='https://twitter.com/share'> <i class='fa fa-twitter'></i> <span class='full'>Twitter</span> </a>")}),$(".media-button").click(function(){return p("shared",null,null,function(){})}),$(".skip-button").click(function(n){return n.preventDefault(),p("skipped",null,null,function(){return i()})}),$(".flag-button").click(function(n){var t,e,a;return t=$(this),a=t.data("flaged"),n.preventDefault(),null!=a&&a?void 0:(e={ad_id:$("#ad_id").val()},$.ajax({type:"post",dataType:"json",url:""+z+"/ads/flag",data:e,success:function(){return $(".flag-button").text("Flaged!"),t.data("flaged",!0),t.css(":hover","background-color: #0088FF")}}))})},d=function(n,t){var e,a,i,r,o,u,l;for(a=i=0,o=n-1;o>=i;a=i+=1)e=t.eq(a).find("i"),e.removeClass("fa-heart-o"),e.addClass("fa-heart");if(5>n){for(l=[],a=r=u=n;4>=u?4>=r:r>=4;a=4>=u?++r:--r)e=t.eq(a).find("i"),e.removeClass("fa-heart"),l.push(e.addClass("fa-heart-o"));return l}},C=function(){var n;return n=$(".rate-ad"),n.click(function(){var t;return t=$(this).data("rating"),p("rated",null,t,function(){return d(t,n),$(".a2ma .a2mad").data("posted_rating",t)}),n.off("mouseleave"),n.mouseleave(function(){return t=$(".a2ma .a2mad").data("posted_rating"),d(t,n)})}),n.hover(function(){var t;return t=$(this).data("rating"),d(t,n)}),n.mouseleave(function(){return n.find("i").addClass("fa-heart-o").removeClass("fa-heart")})},$(".content-container").click(function(n){var t;return t=$(this).data("url"),"mini"===u()?p("clicked",null,null,function(){return window.open(t)}):n.preventDefault()}),$(".navigation-url").click(function(n){var t;return n.preventDefault(),t=$(this).attr("href"),p("clicked",null,null,function(){return window.open(t)})}),C(),_(),y()})}).call(this);